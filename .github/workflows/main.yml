name: CI/CD Pipeline

on:
  push:
    branches: ["**"]

permissions:
  contents: read
  packages: write

jobs:
  frontend-lint:
    uses: ./.github/workflows/pipelines/frontend-lint.yml

  backend-lint:
    uses: ./.github/workflows/pipelines/backend-lint.yml

  frontend-test:
    needs:
      - frontend-lint
      - backend-lint
    uses: ./.github/workflows/pipelines/frontend-test.yml

  backend-test:
    needs:
      - frontend-lint
      - backend-lint
    uses: ./.github/workflows/pipelines/backend-test.yml

  frontend-build-image:
    needs:
      - frontend-test
      - backend-test
    if: github.ref == 'refs/heads/main'
    uses: ./.github/workflows/pipelines/frontend-build-image.yml
    secrets: inherit

  backend-build-image:
    needs:
      - frontend-test
      - backend-test
    if: github.ref == 'refs/heads/main'
    uses: ./.github/workflows/pipelines/backend-build-image.yml
    secrets: inherit

  deploy:
    needs:
      - frontend-build-image
      - backend-build-image
    if: github.ref == 'refs/heads/main'
    uses: ./.github/workflows/pipelines/deploy.yml
    secrets: inherit
